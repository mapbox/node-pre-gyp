# http://www.appveyor.com/docs/appveyor-yml

image: 
  - Visual Studio 2022

environment:
  matrix:
    - nodejs_version: 16
    - nodejs_version: 18
    - nodejs_version: 20

platform:
  - x64
  - x86

shallow_clone: true

install:
  - ps: Install-Product node $env:nodejs_version $env:platform
  - ps: Set-ExecutionPolicy Unrestricted -Scope CurrentUser -Force
  - npm config get
  - node --version
  - npm --version
  - node -e "console.log(process.arch);"
  # - pwd || true
  # - ls -la || true
  # - ls -la /c/ || true
  # - ls -la "/c/Program Files (x86)" || true
  # - export VCINSTALLDIR="/c/Program Files (x86)/Microsoft Visual Studio/Installer"
  # - npm config set VCINSTALLDIR "C:\Program Files (x86)\Microsoft Visual Studio\Installer"
  - npm config set msvs_version 2022 || true
  #- IF /I "%PLATFORM%" == "x64" npm config set npm_config_python C:\Python311-x64\python.exe
  #- IF /I "%PLATFORM%" == "x86" npm config set npm_config_python C:\Python311\python.exe
  - npm config list || true
  - py --list-paths
  # - ls -laR $VCINSTALLDIR || true
  # - ls -laR "%VCINSTALLDIR%" || true
  # - ls -la "/c/Program Files (x86)/Microsoft Visual Studio/2022/Community/VC/vcvarsall.bat" || true
  - IF /I "%PLATFORM%" == "x64" set PATH=C:\Python311-x64;%PATH%
  - IF /I "%PLATFORM%" == "x86" SET PATH=C:\python311;%PATH%
  # - IF /I "%PLATFORM%" == "x64" CALL "C:\Program Files (x86)\Microsoft Visual Studio\Installer\setup.exe" amd64
  # - IF /I "%PLATFORM%" == "x86" CALL "C:\Program Files (x86)\Microsoft Visual Studio\Installer\vs_installer.exe" x86
  - npm ci
  - npm test

build: off
test: off
deploy: off
